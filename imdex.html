<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Content Summarizer</title>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI Content Summarizer</h1>
            <p>Paste your article or URL and get a concise summary instantly</p>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchTab('text')">Paste Text</button>
                    <button class="tab-button" onclick="switchTab('url')">Enter URL</button>
                </div>
                
                <div id="text-tab" class="tab-content active">
                    <textarea 
                        id="article-text" 
                        placeholder="Paste your long article here... (Minimum 200 characters)"
                        oninput="updateCharCount()"
                    ></textarea>
                    <div class="stats">
                        <span id="char-count">0 characters</span>
                        <span id="word-count">0 words</span>
                    </div>
                </div>
                
                <div id="url-tab" class="tab-content">
                    <input 
                        type="url" 
                        id="article-url" 
                        placeholder="Enter article URL (e.g., https://example.com/article)"
                    >
                </div>
                
                <button id="summarize-btn" class="button" onclick="summarizeContent()">
                    Summarize Content
                </button>
            </div>
            
            <div class="summary-section">
                <h3>Summary</h3>
                <div id="summary-box" class="summary-box">
                    <p id="summary-placeholder">Your summary will appear here...</p>
                    <div id="loading" class="loading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Analyzing content and generating summary...</p>
                    </div>
                    <div id="summary-content"></div>
                </div>
                <div class="stats" id="summary-stats" style="display: none;">
                    <span id="summary-length"></span>
                    <span id="reduction-percentage"></span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'text';

        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tab}-tab`).classList.add('active');
            
            currentTab = tab;
        }

        function updateCharCount() {
            const text = document.getElementById('article-text').value;
            const charCount = text.length;
            const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
            
            document.getElementById('char-count').textContent = `${charCount} characters`;
            document.getElementById('word-count').textContent = `${wordCount} words`;
        }

        async function summarizeContent() {
            const button = document.getElementById('summarize-btn');
            const loading = document.getElementById('loading');
            const summaryContent = document.getElementById('summary-content');
            const summaryPlaceholder = document.getElementById('summary-placeholder');
            const summaryStats = document.getElementById('summary-stats');

            // Reset previous results
            summaryContent.innerHTML = '';
            summaryPlaceholder.style.display = 'block';
            summaryStats.style.display = 'none';

            let content = '';
            
            if (currentTab === 'text') {
                content = document.getElementById('article-text').value.trim();
                if (content.length < 200) {
                    showError('Please enter at least 200 characters for summarization.');
                    return;
                }
            } else {
                content = document.getElementById('article-url').value.trim();
                if (!content) {
                    showError('Please enter a valid URL.');
                    return;
                }
                if (!isValidUrl(content)) {
                    showError('Please enter a valid URL starting with http:// or https://');
                    return;
                }
            }

            // Show loading state
            button.disabled = true;
            button.textContent = 'Summarizing...';
            loading.style.display = 'block';
            summaryPlaceholder.style.display = 'none';

            try {
                const response = await fetch('/api/summarize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        content: content,
                        type: currentTab
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to generate summary');
                }

                // Display summary
                summaryPlaceholder.style.display = 'none';
                summaryContent.innerHTML = `<p>${data.summary}</p>`;
                
                // Display stats
                if (data.originalLength && data.summaryLength) {
                    const reduction = Math.round((1 - data.summaryLength / data.originalLength) * 100);
                    document.getElementById('summary-length').textContent = 
                        `Summary: ${data.summaryLength} words`;
                    document.getElementById('reduction-percentage').textContent = 
                        `Reduced by ${reduction}%`;
                    summaryStats.style.display = 'flex';
                }

            } catch (error) {
                showError(error.message);
            } finally {
                // Reset button state
                button.disabled = false;
                button.textContent = 'Summarize Content';
                loading.style.display = 'none';
            }
        }

        function showError(message) {
            const summaryBox = document.getElementById('summary-box');
            let errorDiv = document.getElementById('error-message');
            
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.id = 'error-message';
                errorDiv.className = 'error';
                summaryBox.appendChild(errorDiv);
            }
            
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            // Remove error after 5 seconds
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // Initialize character count
        updateCharCount();
    </script>
</body>
</html>
